!function(a){Craft.Updater=Garnish.Base.extend({$graphic:null,$status:null,error:null,data:null,init:function(b){this.$graphic=a("#graphic"),this.$status=a("#status")},parseStatus:function(a){return"<p>"+Craft.escapeHtml(a).split("\n\n").join("</p><p>")+"</p>"},showStatus:function(a){this.$status.html(this.parseStatus(a))},showError:function(a){this.$graphic.addClass("error"),this.showStatus(a)},showErrorDetails:function(b){a("<div/>",{id:"error",class:"code",html:this.parseStatus(b)}).appendTo(this.$status)},postActionRequest:function(b){var c={data:this.data};Craft.postActionRequest("updater/"+b,c,a.proxy(function(a,b,c){"success"===b?this.setState(a):this.handleFatalError(c)},this),{complete:a.noop})},setState:function(a){this.$graphic.removeClass("error"),a.data&&(this.data=a.data),a.status?this.showStatus(a.status):a.error&&(this.showError(a.error),a.errorDetails&&this.showErrorDetails(a.errorDetails)),a.nextAction?this.postActionRequest(a.nextAction):a.options?this.showOptions(a):a.finished&&this.onFinish(a.returnUrl)},showOptions:function(b){for(var c=a("<div/>",{id:"options",class:"buttons"}).appendTo(this.$status),d=0;d<b.options.length;d++){var e=b.options[d],f=a("<a/>",{class:"btn big",text:e.label}).appendTo(c);e.submit&&f.addClass("submit"),e.email?f.attr("href",this.getEmailLink(b,e)):this.addListener(f,"click",e,"onOptionSelect")}},getEmailLink:function(a,b){var c="mailto:"+b.email+"?subject="+encodeURIComponent(b.subject||"Craft update failure"),d="Describe what happened here.";return a.errorDetails&&(d+="\n\n-----------------------------------------------------------\n\n"+a.errorDetails),c+="&body="+encodeURIComponent(d)},onOptionSelect:function(a){this.setState(a.data)},onFinish:function(a){this.$graphic.addClass("success"),setTimeout(function(){a?window.location=Craft.getUrl(a):window.location=Craft.getUrl("dashboard")},750)},handleFatalError:function(a){var b=Craft.t("app","Status:")+" "+a.statusText+"\n\n"+Craft.t("app","Response:")+" "+a.responseText+"\n\n";this.setState({error:Craft.t("app","A fatal error has occurred:"),errorDetails:b,options:[{label:Craft.t("app","Send for help"),submit:!0,email:"support@craftcms.com"}]}),Craft.postActionRequest("updater/finish",{data:this.data})}})}(jQuery);
//# sourceMappingURL=Updater.min.js.map