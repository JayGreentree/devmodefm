{# @var craft \craft\web\twig\variables\CraftVariable #}
{% set baseUrl = alias('@baseUrl') ~ '/' %}
{% set staticAssetsVersion = craft.app.config.general.custom.staticAssetsVersion %}
<div class="my-8 w-full">
    <div class="w-full max-w-lg mx-auto">
        {# -- Episode number and date -- #}
        <div>
            <div class="inline-block text-devmode-pink bg-grey-lightest font-mono text-xs text-left uppercase p-8">
                {{ "Episode " ~ episode.episodeNumber }} / {{ episode.postDate |date('Y.m.d') }}
            </div>
        </div>
        {# -- Episode title -- #}
        <div>
            <div class="inline-block bg-grey-lightest p-8">
                <strong>
                    <h1 class="text-devmode-pink font-mono italic text-bold text-4xl sm:text-5xl">
                        <a href="{{ episode.url }}" class="title-link">
                        {{ episode.title |typogrify(true) }}
                        </a>
                    </h1>
                </strong>
            </div>
        </div>
        {# -- Episode hosts -- #}
        <div>
            <div class="inline-block text-devmode-pink bg-grey-lightest font-mono text-xs text-left p-8">
                {% for host in episode.episodeHosts.all() %}{{ host.fullName }}{% if not loop.last %}, {% endif %}{% endfor %}
            </div>
        </div>
        {# -- Episode tags -- #}
        <div>
            <div class="inline-block bg-grey-lightest p-8">
                {% for tag in episode.episodeTags.all() %}
                    <span class="devmode-tags">
                        #{{ tag.title }}
                    </span>
                {% endfor %}
            </div>
        </div>
        {# -- Episode summary -- #}
        <div>
            <div class="inline-block text-devmode-pink bg-grey-lightest font-sans text-xl p-8 leading-normal">
                {{ episode.episodeSummary |nl2br |typogrify }}
            </div>
        </div>
        {# -- Reference links -- #}
        {% if  episode.episodeReferenceLinks |length %}
            <div>
                <div class="inline-block text-devmode-pink bg-grey-lightest font-sans text-2xl p-8">
                    <i class="icon-info-circled align-middle"></i>
                    <ul class="list-reset inline">
                        {% for link in episode.episodeReferenceLinks %}
                            <li class="inline">
                                <a href="{{ link.linkUrl }}" class="tags-link align-middle whitespace-no-wrap" title="{{ link.linkName }}" target="_blank" rel="nofollow noopener">{{ link.linkName }}</a>
                                <span> </span>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        {% endif %}
        {# -- Comments -- #}
        {% set commentsCount = disqusCount(episode.slug) %}
        <div class="inline-block text-devmode-pink bg-grey-lightest font-sans text-2xl p-8">
            <a class="title-link" href="{{ episode.url ~ "#comments" }}">
                <i class="icon-comment align-middle"></i>
                <span class="text-devmode-pink bg-grey-lightest font-sans text-xl leading-normal align-middle">
                    {{ commentsCount }} {{ "comment" | pluralize(commentsCount, 1) }}
                </span>
            </a>
        </div>
    </div>
</div>

<div class="p-8 my-8 w-full bg-grey-lightest rounded-full">
    <div class="w-full mx-auto">
{# -- Audio player -- #}
        {% set transAudioUrl = craft.transcoder.getAudioUrl(episode.episodeMedia.one(), {
            "audioBitRate": "64k",
            "audioSampleRate": 22050,
            "audioChannels": 1
        }) %}
        {% if transAudioUrl |length %}
            {% if not craft.app.config.general.devMode %}
                {% set transAudioUrl = transAudioUrl | replace('/^(http|https):/', '') %}
                {% set transAudioUrl = transAudioUrl | replace('//', '') %}
                {% set transAudioUrl = "https://dts.podtrac.com/redirect.mp3/#{transAudioUrl}" %}
            {% endif %}
            <div class="">
                <div id="single-song-player">
                    <div class="bottom-container flex items-center justify-center">
                        <div class="flex flex-shrink">
                            {% if craft.app.config.general.devMode %}
                            <amp-audio src="{{ transAudioUrl }}"
                                width="250"
                                height="30"
                                title="{{ episode.title }}"
                                album="{{ showInfo.showTitle }}"
                                artist="{{ showInfo.showTitle }}"
                                controls>
                                <source type="audio/mpeg" src="{{ transAudioUrl }}">
                            </amp-audio>
                            {% else %}
                            <amp-audio src="{{ transAudioUrl }}">
                                width="250"
                                height="30"
                                title="{{ episode.title }}"
                                album="{{ showInfo.showTitle }}"
                                artist="{{ showInfo.showTitle }}"
                                controls>
                                <source type="audio/mpeg" src="{{ transAudioUrl }}">
                            </amp-audio>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
</div>
